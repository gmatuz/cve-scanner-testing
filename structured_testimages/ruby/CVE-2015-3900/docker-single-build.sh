#!/bin/bash

CWD=$(pwd)
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"

FOLDER=$DIR/buildfiles/$1/
DIR_STRIPED=${FOLDER%*/}
TAG=${DIR_STRIPED##*/}

echo -n "----------- Building ${TAG} -----------"

cd $FOLDER

if [ -f "$FOLDER/download.sh" ]
then
  bash $FOLDER/download.sh
fi

cp $DIR/hello_world.rb $FOLDER
docker build . -t cvescan_ruby_$TAG:CVE-2015-3900

rm $FOLDER/hello_world.rb

if [ -f "$FOLDER/rm-downloaded.sh" ]
then
  bash $FOLDER/rm-downloaded.sh
fi

cd $CWD

