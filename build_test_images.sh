#!/bin/bash
PWD=$(pwd)
(cd ./testimages/ruby/CVE-2015-3900/ && sh docker-build.sh)
(cd ./testimages/tomcat8/CVE-2015-5351/ && sh docker-build.sh)
(cd ./testimages/redis/CVE-2019-10192/ && sh build-images.sh)
(cd ./testimages/nginx/CVE-2018-16843/ && sh build-images.sh)
(cd ./testimages/haproxy/CVE-2019-18277/ && sh build-images.sh)
(cd ./testimages/perl/CVE-2018-6797/ && sh build-images.sh)
(cd ./testimages/gunicorn/CVE-2018-1000164/ && sh build-images.sh)
(cd ./testimages/nodejs/CVE-2019-15605/ && sh build-images.sh)

docker image ls  $imagepath | grep ruby | sed 's/   /\:/' | sed 's/ .*//' | sed -e 's/$/ CVE-2015-3900/' > images_to_scan
docker image ls  $imagepath | grep tomcat | sed 's/   /\:/' | sed 's/ .*//' | sed -e 's/$/ CVE-2015-5351/' >> images_to_scan
docker image ls  $imagepath | grep redis | sed 's/   /\:/' | sed 's/ .*//' | sed -e 's/$/ CVE-2019-10192/' >> images_to_scan
docker image ls  $imagepath | grep nginx | sed 's/   /\:/' | sed 's/ .*//' | sed -e 's/$/ CVE-2018-16843/' >> images_to_scan
docker image ls  $imagepath | grep haproxy | sed 's/   /\:/' | sed 's/ .*//' | sed -e 's/$/ CVE-2019-18277/' >> images_to_scan
docker image ls  $imagepath | grep perl | sed 's/   /\:/' | sed 's/ .*//' | sed -e 's/$/ CVE-2018-6797/' >> images_to_scan
docker image ls  $imagepath | grep gunicorn | sed 's/   /\:/' | sed 's/ .*//' | sed -e 's/$/ CVE-2018-1000164/' >> images_to_scan
docker image ls  $imagepath | grep nodejs | sed 's/   /\:/' | sed 's/ .*//' | sed -e 's/$/ CVE-2019-15605/' >> images_to_scan


./validate_images.sh