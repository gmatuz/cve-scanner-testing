#!/bin/bash

CWD=$(pwd)
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"

FOLDER=$DIR/buildfiles/$1/
DIR_STRIPED=${FOLDER%*/}
TAG=${DIR_STRIPED##*/}

echo -n "----------- Building ${TAG} -----------"

cd $FOLDER

if [ -f "$FOLDER/download.sh" ]
then
  bash $FOLDER/download.sh
fi

cp $DIR/build.properties $DIR/logging.properties $DIR/server.xml $FOLDER
docker build . -t cvescan_tomcat_$TAG:CVE-2015-5351

rm $FOLDER/logging.properties $FOLDER/server.xml $FOLDER/build.properties

if [ -f "$FOLDER/rm-downloaded.sh" ]
then
  bash $FOLDER/rm-downloaded.sh
fi

cd $CWD

