FROM debian_haproxy:src_base as Builder
FROM debian_haproxy:baseimage
#Doing multistage here does not make too much sense, included it to see if it makes a difference for scanning
COPY --from=Builder /usr/sbin/haproxy /usr/sbin/haproxy
COPY --from=Builder /var/lib/haproxy /var/lib/haproxy
RUN mkdir -p /var/lib/haproxy && \
    chown "$HAPROXY_UID:$HAPROXY_GID" /var/lib/haproxy && \
    mkdir -p /usr/local/etc/haproxy && \
    ln -s /usr/local/etc/haproxy /etc/haproxy
COPY --from=Builder /lib/x86_64-linux-gnu/libcrypt.so.1 /lib/x86_64-linux-gnu/libz.so.1 /lib/x86_64-linux-gnu/libpcre.so.3  /lib/x86_64-linux-gnu/libc.so.6 /lib/x86_64-linux-gnu/libdl.so.2  /lib/x86_64-linux-gnu/libpthread.so.0 /lib/x86_64-linux-gnu/
COPY --from=Builder /usr/lib/x86_64-linux-gnu/libcrypto.so.1.0.0 /usr/lib/x86_64-linux-gnu/libssl.so.1.0.0  /usr/lib/x86_64-linux-gnu/libpcreposix.so.3  /usr/lib/x86_64-linux-gnu/
